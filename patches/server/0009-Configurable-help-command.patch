From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Pascalpex <pascalpex@gmail.com>
Date: Thu, 17 Feb 2022 19:10:53 +0100
Subject: [PATCH] Configurable help command


diff --git a/src/main/java/net/minecraft/commands/Commands.java b/src/main/java/net/minecraft/commands/Commands.java
index 8d94128353c55148b4e840701fc7d881e3d92551..18789dc24200df433e890409b31e84e7862ccd53 100644
--- a/src/main/java/net/minecraft/commands/Commands.java
+++ b/src/main/java/net/minecraft/commands/Commands.java
@@ -154,7 +154,7 @@ public class Commands {
         GameModeCommand.register(this.dispatcher);
         GameRuleCommand.register(this.dispatcher);
         GiveCommand.register(this.dispatcher);
-        HelpCommand.register(this.dispatcher);
+        //HelpCommand.register(this.dispatcher); Deepslate configurable help command
         ItemCommands.register(this.dispatcher);
         KickCommand.register(this.dispatcher);
         KillCommand.register(this.dispatcher);
diff --git a/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java b/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java
index 2d01d6c49d313ec19eced87961877da3f9bc5ac6..c155d30c6c2d74bf3912bc58abe2aaa08eab3f12 100644
--- a/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java
+++ b/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java
@@ -269,6 +269,8 @@ public class DedicatedServer extends MinecraftServer implements ServerInterface
         MinecraftServer.getServer().server.getCommandMap().register("buildworld", "Deepslate", new BuildworldCommand("buildworld"));
         MinecraftServer.getServer().server.getCommandMap().register("maintenance", "Deepslate", new MaintenanceMode("maintenance"));
         MinecraftServer.getServer().server.getCommandMap().register("wartung", "Deepslate", new MaintenanceMode("wartung"));
+        MinecraftServer.getServer().server.getCommandMap().register("help", "Deepslate", new HelpCommand("help"));
+        MinecraftServer.getServer().server.getCommandMap().register("hilfe", "Deepslate", new HelpCommand("hilfe"));
         // Deepslate end
 
         this.setPvpAllowed(dedicatedserverproperties.pvp);
diff --git a/src/main/java/net/pascalpex/deepslatemc/MessagesFile.java b/src/main/java/net/pascalpex/deepslatemc/MessagesFile.java
index 2da21be0aa6defda86430a40b4049427d3951f4e..cda520e47a4cb4f5fc0dddde1da1dd16d8de6de4 100644
--- a/src/main/java/net/pascalpex/deepslatemc/MessagesFile.java
+++ b/src/main/java/net/pascalpex/deepslatemc/MessagesFile.java
@@ -6,6 +6,8 @@ import org.bukkit.configuration.file.YamlConfiguration;
 
 import java.io.File;
 import java.io.IOException;
+import java.util.ArrayList;
+import java.util.List;
 
 public class MessagesFile {
 
@@ -59,6 +61,14 @@ public class MessagesFile {
             if (!config.contains("maintenanceOff")) {
                 config.set("maintenanceOff", "&aYou turned off the maintenance mode");
             }
+            if (!config.contains("helpMessage")) {
+                List<String> message = new ArrayList<String>();
+                message.add("&2&l--Help page--");
+                message.add("&6You can find the most important commands at");
+                message.add("&9&l/warp &9&lInfo&r&6. If you have more");
+                message.add("&6questions, please ask a &9team member.");
+                config.set("helpMessage", message);
+            }
             save();
         } catch (IOException | InvalidConfigurationException e) {
             e.printStackTrace();
@@ -73,6 +83,19 @@ public class MessagesFile {
         }
     }
 
+    public static String getHelpMessage() {
+        List<String> messages = (List<String>) config.getList("helpMessage");
+        String message = "";
+        for(int i = 0; i < messages.size(); i++) {
+            message = message + messages.get(i).replace("&", "§");
+            if(i < messages.size() - 1) {
+                message = message + "\n§r";
+            }
+        }
+        
+        return message;
+    }
+
     public static String getPrefix() {
         String prefix = config.getString("prefix");
         return prefix.replace("&", "§");
diff --git a/src/main/java/net/pascalpex/deepslatemc/commands/HelpCommand.java b/src/main/java/net/pascalpex/deepslatemc/commands/HelpCommand.java
new file mode 100644
index 0000000000000000000000000000000000000000..18c716d6d2da7e4ce25d7ba5be5fe0a29e192e44
--- /dev/null
+++ b/src/main/java/net/pascalpex/deepslatemc/commands/HelpCommand.java
@@ -0,0 +1,24 @@
+package net.pascalpex.deepslatemc.commands;
+
+import net.pascalpex.deepslatemc.MessagesFile;
+import org.bukkit.command.Command;
+import org.bukkit.command.CommandSender;
+import org.jetbrains.annotations.NotNull;
+
+public class HelpCommand extends Command {
+
+    public HelpCommand(@NotNull String name) {
+        super(name);
+        this.description = "Shows the configured help page";
+        this.usageMessage = "/help";
+    }
+
+    @Override
+    public boolean execute(@NotNull CommandSender sender, @NotNull String label, @NotNull String[] args) {
+        if (label.equalsIgnoreCase("help") || label.equalsIgnoreCase("hilfe")) {
+            sender.sendMessage(MessagesFile.getHelpMessage());
+        }
+        return true;
+    }
+
+}
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index 402f73907a7415dd9c28d658acb1d1bd1cf6b6de..581c20bf8ec7ab47b33308f7a41e1ad5221cd874 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -1009,6 +1009,8 @@ public final class CraftServer implements Server {
         MinecraftServer.getServer().server.getCommandMap().register("buildworld", "Deepslate", new BuildworldCommand("buildworld"));
         MinecraftServer.getServer().server.getCommandMap().register("maintenance", "Deepslate", new MaintenanceMode("maintenance"));
         MinecraftServer.getServer().server.getCommandMap().register("wartung", "Deepslate", new MaintenanceMode("wartung"));
+        MinecraftServer.getServer().server.getCommandMap().register("help", "Deepslate", new HelpCommand("help"));
+        MinecraftServer.getServer().server.getCommandMap().register("hilfe", "Deepslate", new HelpCommand("hilfe"));
         // Deepslate end
 
         this.overrideAllCommandBlockCommands = this.commandsConfiguration.getStringList("command-block-overrides").contains("*");
