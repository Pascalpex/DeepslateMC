From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Pascalpex <pascalpex@gmail.com>
Date: Mon, 25 Dec 2023 15:56:49 +0100
Subject: [PATCH] Tablist header footer


diff --git a/src/main/java/net/minecraft/server/players/PlayerList.java b/src/main/java/net/minecraft/server/players/PlayerList.java
index 484ebac18e8de6df1238c50167862c109f47c3bd..82a73b02f9fec29cbae07b0df23ed6a579eec4d9 100644
--- a/src/main/java/net/minecraft/server/players/PlayerList.java
+++ b/src/main/java/net/minecraft/server/players/PlayerList.java
@@ -103,9 +103,11 @@ import net.minecraft.world.phys.Vec3;
 import net.minecraft.world.scores.DisplaySlot;
 import net.minecraft.world.scores.Objective;
 import net.minecraft.world.scores.PlayerTeam;
+import net.pascalpex.deepslatemc.Config;
 import net.pascalpex.deepslatemc.MessagesFile;
 import net.pascalpex.deepslatemc.commands.MaintenanceMode;
 import net.pascalpex.deepslatemc.commands.SpawnCommand;
+import net.pascalpex.deepslatemc.util.TablistUtil;
 import org.galemc.gale.configuration.GaleGlobalConfiguration;
 import org.slf4j.Logger;
 
@@ -358,6 +360,11 @@ public abstract class PlayerList {
 
         PlayerJoinEvent playerJoinEvent = new PlayerJoinEvent(bukkitPlayer, io.papermc.paper.adventure.PaperAdventure.asAdventure(ichatmutablecomponent)); // Paper - Adventure
         SpawnCommand.playerJoin(bukkitPlayer); // Deepslate - Spawn functions
+        // Deepslate start - Tablist
+        if (Config.getTablistEnabled()) {
+            TablistUtil.setTablist(bukkitPlayer);
+        }
+        // Deepslate end
         this.cserver.getPluginManager().callEvent(playerJoinEvent);
 
         if (!player.connection.isAcceptingMessages()) {
diff --git a/src/main/java/net/pascalpex/deepslatemc/Config.java b/src/main/java/net/pascalpex/deepslatemc/Config.java
index d09379b9e668dc01d71740ece750d968deee8c46..15caaf6d1f07a17b4cdcb27cf8d84992e1211a34 100644
--- a/src/main/java/net/pascalpex/deepslatemc/Config.java
+++ b/src/main/java/net/pascalpex/deepslatemc/Config.java
@@ -58,6 +58,17 @@ public class Config {
             if (!config.contains("f3name")) {
                 config.set("f3name", "&eDeepslateMC");
             }
+            if (!config.contains("tablist")) {
+                config.set("tablist" + ".enabled", false);
+                List<String> headerList = new ArrayList<>();
+                List<String> footerList = new ArrayList<>();
+                headerList.add("&4This is the");
+                headerList.add("&4default header");
+                footerList.add("&6This is the");
+                footerList.add("&6default footer");
+                config.set("tablist" + ".header", headerList);
+                config.set("tablist" + ".footer", footerList);
+            }
             save();
         } catch (IOException | InvalidConfigurationException e) {
             e.printStackTrace();
@@ -127,5 +138,14 @@ public class Config {
     public static String getF3name() {
         return config.getString("f3name").replace("&", "ยง");
     }
+    public static boolean getTablistEnabled() {
+        return config.getBoolean("tablist" + ".enabled");
+    }
+    public static List<String> getHeader() {
+        return (List<String>) config.getList("tablist" + ".header");
+    }
+    public static List<String> getFooter() {
+        return (List<String>) config.getList("tablist" + ".footer");
+    }
 
 }
diff --git a/src/main/java/net/pascalpex/deepslatemc/commands/DeepslateCommand.java b/src/main/java/net/pascalpex/deepslatemc/commands/DeepslateCommand.java
index c11d3597dbc49a1f6d75a55f427c55fc55d68a29..952422775b768a43bb95c62e33475edb96c492ee 100644
--- a/src/main/java/net/pascalpex/deepslatemc/commands/DeepslateCommand.java
+++ b/src/main/java/net/pascalpex/deepslatemc/commands/DeepslateCommand.java
@@ -2,6 +2,7 @@ package net.pascalpex.deepslatemc.commands;
 
 import net.pascalpex.deepslatemc.Config;
 import net.pascalpex.deepslatemc.MessagesFile;
+import net.pascalpex.deepslatemc.util.TablistUtil;
 import org.bukkit.ChatColor;
 import org.bukkit.Location;
 import org.bukkit.command.Command;
@@ -45,6 +46,9 @@ public class DeepslateCommand extends Command {
                         if (args[0].equalsIgnoreCase("reload")) {
                             MessagesFile.load();
                             Config.load();
+                            if (Config.getTablistEnabled()) {
+                                TablistUtil.reloadTablist();
+                            }
                             player.sendMessage(prefix + MessagesFile.getConfigReloaded());
                         } else {
                             if (args[0].equalsIgnoreCase("version")) {
diff --git a/src/main/java/net/pascalpex/deepslatemc/util/TablistUtil.java b/src/main/java/net/pascalpex/deepslatemc/util/TablistUtil.java
new file mode 100644
index 0000000000000000000000000000000000000000..906708e425ee1ae110f350d951b1e9463684b1aa
--- /dev/null
+++ b/src/main/java/net/pascalpex/deepslatemc/util/TablistUtil.java
@@ -0,0 +1,46 @@
+package net.pascalpex.deepslatemc.util;
+
+import net.pascalpex.deepslatemc.Config;
+import org.bukkit.Bukkit;
+import org.bukkit.entity.Player;
+
+public class TablistUtil {
+
+    private static boolean initiated = false;
+    private static String header = "";
+    private static String footer = "";
+
+    public static void setTablist(Player player) {
+        if (!initiated) {
+            reloadTablist();
+        }
+        player.setPlayerListHeader(header);
+        player.setPlayerListFooter(footer);
+    }
+
+    public static void reloadTablist() {
+        header = "";
+        footer = "";
+        for (String s : Config.getHeader()) {
+            if (!header.equals("")) {
+                header += "\n";
+            }
+            header += s;
+        }
+        for (String s : Config.getFooter()) {
+            if (!footer.equals("")) {
+                footer += "\n";
+            }
+            footer += s;
+        }
+        header = header.replace("&", "ยง");
+        footer = footer.replace("&", "ยง");
+
+        initiated = true;
+
+        for (Player player : Bukkit.getOnlinePlayers()) {
+            setTablist(player);
+        }
+    }
+
+}
