From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Pascalpex <pascalpex@gmail.com>
Date: Tue, 15 Feb 2022 12:56:35 +0100
Subject: [PATCH] Config and messages file


diff --git a/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java b/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java
index c434373557639463b862615552183a61665f01d0..8bb7e1d2747eb132dfe051af831523c887dd2d5b 100644
--- a/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java
+++ b/src/main/java/net/minecraft/server/dedicated/DedicatedServer.java
@@ -58,6 +58,8 @@ import net.minecraft.world.level.GameType;
 import net.minecraft.world.level.block.entity.SkullBlockEntity;
 import net.minecraft.world.level.storage.LevelStorageSource;
 import net.minecraft.world.level.storage.WorldData;
+import net.pascalpex.deepslatemc.Config;
+import net.pascalpex.deepslatemc.MessagesFile;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 import org.apache.logging.log4j.Level;
@@ -254,6 +256,11 @@ public class DedicatedServer extends MinecraftServer implements ServerInterface
         wtf.etil.mirai.MiraiConfig.registerCommands();
         // Mirai end
 
+        // Deepslate start
+        MessagesFile.load();
+        Config.load();
+        // Deepslate end
+
         this.setPvpAllowed(dedicatedserverproperties.pvp);
         this.setFlightAllowed(dedicatedserverproperties.allowFlight);
         this.setResourcePack(dedicatedserverproperties.resourcePack, this.getPackHash());
diff --git a/src/main/java/net/pascalpex/deepslatemc/Config.java b/src/main/java/net/pascalpex/deepslatemc/Config.java
new file mode 100644
index 0000000000000000000000000000000000000000..8e3a1629a0fd78dd95db003a1e127d23b247df90
--- /dev/null
+++ b/src/main/java/net/pascalpex/deepslatemc/Config.java
@@ -0,0 +1,36 @@
+package net.pascalpex.deepslatemc;
+
+import org.bukkit.configuration.InvalidConfigurationException;
+import org.bukkit.configuration.file.FileConfiguration;
+import org.bukkit.configuration.file.YamlConfiguration;
+
+import java.io.File;
+import java.io.IOException;
+
+public class Config {
+
+    public static File configFile = new File("deepslate", "deepslate.yml");
+    public static FileConfiguration config = YamlConfiguration.loadConfiguration(configFile);
+
+    public static void load() {
+        try {
+            configFile.getParentFile().mkdirs();
+            if (!configFile.exists()) {
+                configFile.createNewFile();
+                save();
+            }
+            config.load(configFile);
+        } catch (IOException | InvalidConfigurationException e) {
+            e.printStackTrace();
+        }
+    }
+
+    public static void save() {
+        try {
+            config.save(configFile);
+        } catch (IOException e) {
+            e.printStackTrace();
+        }
+    }
+
+}
diff --git a/src/main/java/net/pascalpex/deepslatemc/MessagesFile.java b/src/main/java/net/pascalpex/deepslatemc/MessagesFile.java
new file mode 100644
index 0000000000000000000000000000000000000000..b6f529b7e5adf0b497d5c8d783e70fec072e456c
--- /dev/null
+++ b/src/main/java/net/pascalpex/deepslatemc/MessagesFile.java
@@ -0,0 +1,45 @@
+package net.pascalpex.deepslatemc;
+
+import org.bukkit.configuration.InvalidConfigurationException;
+import org.bukkit.configuration.file.FileConfiguration;
+import org.bukkit.configuration.file.YamlConfiguration;
+
+import java.io.File;
+import java.io.IOException;
+
+public class MessagesFile {
+
+    public static File configFile = new File("deepslate", "messages.yml");
+    public static FileConfiguration config = YamlConfiguration.loadConfiguration(configFile);
+
+    public static void load() {
+        try {
+            configFile.getParentFile().mkdirs();
+            if (!configFile.exists()) {
+                configFile.createNewFile();
+                save();
+            }
+            config.load(configFile);
+            if(!config.contains("prefix")) {
+                config.set("prefix", "&0[&8DeepslateMC&0]");
+            }
+            save();
+        } catch (IOException | InvalidConfigurationException e) {
+            e.printStackTrace();
+        }
+    }
+
+    public static void save() {
+        try {
+            config.save(configFile);
+        } catch (IOException e) {
+            e.printStackTrace();
+        }
+    }
+
+    public static String getPrefix() {
+        String prefix = config.getString("prefix");
+        return prefix.replace("&", "ยง");
+    }
+
+}
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index af3092860fea2d33dbf7443a314ba6cae75c5933..21581f427b384bac50537f3b67322f4ff788a035 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -113,6 +113,8 @@ import net.minecraft.world.level.storage.PlayerDataStorage;
 import net.minecraft.world.level.storage.PrimaryLevelData;
 import net.minecraft.world.level.storage.loot.LootTables;
 import net.minecraft.world.phys.Vec3;
+import net.pascalpex.deepslatemc.Config;
+import net.pascalpex.deepslatemc.MessagesFile;
 import org.apache.commons.lang.Validate;
 import org.bukkit.BanList;
 import org.bukkit.Bukkit;
@@ -992,6 +994,12 @@ public final class CraftServer implements Server {
         org.spigotmc.SpigotConfig.registerCommands(); // Spigot
         com.destroystokyo.paper.PaperConfig.registerCommands(); // Paper
         org.purpurmc.purpur.PurpurConfig.registerCommands(); // Purpur
+
+        // Deepslate start
+        MessagesFile.load();
+        Config.load();
+        // Deepslate end
+
         this.overrideAllCommandBlockCommands = this.commandsConfiguration.getStringList("command-block-overrides").contains("*");
         this.ignoreVanillaPermissions = this.commandsConfiguration.getBoolean("ignore-vanilla-permissions");
 
